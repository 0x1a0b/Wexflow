function WexflowDesigner(e,t){"use strict";function n(e,n){var a={Id:e,WorkflowInfo:C[e],Tasks:T[e]};E(t+"/save",function(t){var a="true"===t;a===!0?("undefined"!=typeof n&&n(),alert("workflow "+C[e].Id+" saved and reloaded with success.")):alert("An error occured while saving the workflow "+e+".")},function(){alert("An error occured while saving the workflow "+e+".")},a)}function a(e,t){var n=document.createElement("div");n.className="wf-task";var a="<h5 class='wf-task-title'><label class='wf-task-title-label'>Task</label><button type='button' class='wf-remove-task' style='display: block'>remove</button></h5><table class='wf-designer-table'><tbody><tr><td class='wf-title'>Id</td><td class='wf-value'><input class='wf-task-id' type='text' /></td></tr><tr><td class='wf-title'>Name</td><td class='wf-value'><select class='wf-task-name'>";a+="<option value=''></option>";for(var i=0;i<t.length;i++){var r=t[i];a+="<option value='"+r+"'>"+r+"</option>"}a+="</select></td></tr><tr><td class='wf-title'>Description</td><td class='wf-value'><input class='wf-task-desc' type='text' /></td></tr><tr><td class='wf-title'>Enabled</td><td class='wf-value'><input class='wf-task-enabled' type='checkbox' checked /></td></tr></tbody></table><h6>Settings<button type='button' class='wf-add-setting'>setting</button></h6><table class='wf-designer-table wf-settings'></table>",n.innerHTML=a;var o=document.getElementsByClassName("wf-task")[T[e].length-1];"undefined"!=typeof o&&null!=o?o.parentNode.insertBefore(n,o.nextSibling):document.getElementById("wf-tasks").appendChild(n),T[e].push({Id:0,Name:"",Description:"",IsEnabled:!0,Settings:[]});var u=d(n),c=n.getElementsByClassName("wf-task-id")[0];c.onkeyup=function(){T[e][u].Id=c.value,this.parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("wf-task-title-label")[0].innerHTML="Task "+c.value};var f=n.getElementsByClassName("wf-task-name")[0];f.onchange=function(){T[e][u].Name=f.value};var m=n.getElementsByClassName("wf-task-desc")[0];m.onkeyup=function(){T[e][u].Description=m.value};var w=n.getElementsByClassName("wf-task-enabled")[0];w.onchange=function(){T[e][u].IsEnabled=w.checked};var p=n.getElementsByClassName("wf-add-setting")[0];p.onclick=function(){s(e,this)};var v=n.getElementsByClassName("wf-remove-task")[0];v.onclick=function(){l(e,this)}}function l(e,t){var n=d(t.parentElement.parentElement);T[e]=u(T[e],n),t.parentElement.parentElement.remove()}function s(e,t){var n=t.parentElement.parentElement.getElementsByClassName("wf-settings")[0],a=n.insertRow(-1),l=a.insertCell(0),s=a.insertCell(1),r=a.insertCell(2),u=a.insertCell(3);l.className="wf-title",l.innerHTML="<input class='wf-setting-name' type='text' />",s.className="wf-setting-value-td",s.innerHTML="<input class='wf-setting-value' type='text' /><table class='wf-attributes'></table>",r.className="wf-add-attribute-td",r.innerHTML="<button type='button' class='wf-add-attribute'>attribute</button>",u.innerHTML="<button type='button' class='wf-remove-setting'>remove</button>";var c=d(t.parentElement.parentElement),f=T[e][c];f.Settings.push({Name:"",Value:"",Attributes:[]});var m=f.Settings.length-1,w=n.getElementsByClassName("wf-setting-name")[m];w.onkeyup=function(){f.Settings[m].Name=w.value;var e=w.parentElement.parentElement.getElementsByClassName("wf-add-attribute-td")[0];"selectFiles"===w.value||"selectAttachments"===w.value?e.style.display="block":e.style.display="none"};var p=n.getElementsByClassName("wf-setting-value")[m];"undefined"!=typeof p&&null!=p&&(p.onkeyup=function(){f.Settings[m].Value=p.value});var v=n.getElementsByClassName("wf-add-attribute")[m];v.onclick=function(){i(e,this)};var g=n.getElementsByClassName("wf-remove-setting")[m];g.onclick=function(){o(e,this),m--}}function i(e,t){var n=t.parentElement.parentElement.getElementsByClassName("wf-attributes")[0],a=n.insertRow(-1),l=a.insertCell(0),s=a.insertCell(1),i=a.insertCell(2);l.innerHTML="<input class='wf-attribute-name' type='text' />",s.innerHTML="<input class='wf-attribute-value' type='text' />",i.innerHTML="<button type='button' class='wf-remove-attribute'>remove</button>";var o=d(t.parentElement.parentElement.parentElement.parentElement.parentElement),u=T[e][o],c=d(t.parentElement.parentElement);u.Settings[c].Attributes.push({Name:"",Value:""});var f=u.Settings[c].Attributes.length-1,m=n.getElementsByClassName("wf-attribute-name")[f];m.onkeyup=function(){u.Settings[c].Attributes[f].Name=m.value};var w=n.getElementsByClassName("wf-attribute-value")[f];w.onkeyup=function(){u.Settings[c].Attributes[f].Value=w.value};var p=n.getElementsByClassName("wf-remove-attribute")[f];p.onclick=function(){r(e,this),f--}}function r(e,t){var n=d(t.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),a=T[e][n],l=d(t.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),s=d(t.parentElement.parentElement);a.Settings[l].Attributes=u(a.Settings[l].Attributes,s),t.parentElement.parentElement.remove()}function o(e,t){var n=d(t.parentElement.parentElement.parentElement.parentElement.parentElement),a=T[e][n],l=d(t.parentElement.parentElement);a.Settings=u(a.Settings,l),t.parentElement.parentElement.remove()}function d(e){for(var t=0;e=e.previousElementSibling;)t++;return t}function u(e,t){return e=e.slice(0),e.splice(t,1),e}function c(e){return/^\+?(0|[1-9]\d*)$/.test(e)}function f(e,t){for(;e.charAt(e.length-1)===t;)e=e.substring(0,e.length-1);return e}function m(e){return e.replace(/[<>&'"]/g,function(e){switch(e){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}return e})}function w(e,t){return e.Id<t.Id?-1:e.Id>t.Id?1:0}function p(e){switch(e){case 0:return"startup";case 1:return"trigger";case 2:return"periodic";default:return""}}function v(e){switch(e){case"startup":return 0;case"trigger":return 1;case"periodic":return 2;default:return-1}}function g(e,t){for(var n=0;n<e.options.length;n++)if(e.options[n].value===t)return void(e.options[n].selected=!0)}function y(e,t,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&t){var e=JSON.parse(this.responseText);t(e)}},a.onerror=function(){n&&n()},a.open("GET",e,!0),a.send()}function E(e,t,n,a){var l=new XMLHttpRequest;l.onreadystatechange=function(){4===this.readyState&&200===this.status&&t&&t(this.responseText)},l.onerror=function(){n&&n()},l.open("POST",e,!0),l.send(JSON.stringify(a))}function b(e,n){y(t+"/workflow/"+e,function(e){n(e)})}function h(e,n){y(t+"/tasks/"+e,function(e){n(e)})}function k(e,n){y(t+"/xml/"+e,function(e){n(e)})}function I(e){y(t+"/workflows",function(d){function u(e){document.getElementById("wf-cancel").style.display="block",document.getElementById("wf-save").style.display="block",document.getElementById("wf-xml").style.display="inline","none"===document.getElementById("wf-designer-right-panel").style.display&&(document.getElementById("wf-designer-right-panel").style.display="block");var n=document.getElementById("wf-xml-container");n.innerHTML="",document.getElementById("wf-xml").onclick=function(){k(e,function(e){n.innerHTML=m(e),hljs.highlightBlock(n)})},b(e,function(n){C[n.Id]={Id:n.Id,Name:n.Name,LaunchType:n.LaunchType,Period:n.Period,IsEnabled:n.IsEnabled,Description:n.Description,Path:n.Path,IsNew:!1};var d=document.getElementById("wf-id");d.value=n.Id,d.onkeyup=function(){C[e].Id=d.value};var u=document.getElementById("wf-name");u.value=n.Name,u.onkeyup=function(){C[e].Name=u.value};var c=p(n.LaunchType),m=document.getElementById("wf-launchType");g(m,c),m.onchange=function(){C[e].LaunchType=v(m.value)};var w=document.getElementById("wf-period");w.value=n.Period,w.onkeyup=function(){C[e].Period=w.value};var E=document.getElementById("wf-enabled");E.checked=n.IsEnabled,E.onchange=function(){C[e].IsEnabled=E.checked};var b=document.getElementById("wf-desc");b.value=n.Description,b.onkeyup=function(){C[e].Period=b.value},document.getElementById("wf-path").innerHTML=n.Path,clearInterval(x),n.IsEnabled===!0?(x=setInterval(function(){f(e,!1)},S),f(e,!0)):f(e,!0),h(e,function(d){T[e]=d;var u="";y(t+"/taskNames",function(t){for(var c=0;c<d.length;c++){var f=d[c];u+="<div class='wf-task'><h5 class='wf-task-title'><label class='wf-task-title-label'>Task "+f.Id+"</label><button type='button' class='wf-remove-task'>remove</button></h5><table class='wf-designer-table'><tbody><tr><td class='wf-title'>Id</td><td class='wf-value'><input class='wf-task-id' type='text' value='"+f.Id+"'"+(n.IsExecutionGraphEmpty===!1?"readonly":"")+"/></td></tr><tr><td class='wf-title'>Name</td><td class='wf-value'><select class='wf-task-name'>";for(var m=0;m<t.length;m++){var w=t[m];u+="<option value='"+w+"' "+(w===f.Name?"selected":"")+">"+w+"</option>"}u+="</select></td></tr><tr><td class='wf-title'>Description</td><td class='wf-value'><input class='wf-task-desc' type='text' value='"+f.Description+"' /></td></tr><tr><td class='wf-title'>Enabled</td><td class='wf-value'><input class='wf-task-enabled' type='checkbox'   "+(f.IsEnabled?"checked":"")+" /></td></tr></tbody></table><h6>Settings<button type='button' class='wf-add-setting'>setting</button></h6><table class='wf-designer-table wf-settings'><tbody>";for(var p=0;p<f.Settings.length;p++){var v=f.Settings[p];u+="<tr><td class='wf-title'><input class='wf-setting-name' type='text' value='"+v.Name+"'  /></td><td class='wf-setting-value-td'>",u+="<input class='wf-setting-value' type='text' value='"+v.Value+"'  />",u+="<table class='wf-attributes'>";for(var g=0;g<v.Attributes.length;g++){var y=v.Attributes[g];u+="<tr><td><input class='wf-attribute-name' type='text' value='"+y.Name+"'  /></td><td><input class='wf-attribute-value' type='text' value='"+y.Value+"'  /></td><td><button type='button' class='wf-remove-attribute'>remove</button></td></tr>"}u+="</table>",u+="</td><td class='wf-add-attribute-td'><button type='button' class='wf-add-attribute'>attribute</button></td><td><button type='button' class='wf-remove-setting'>remove</button></td></tr>"}u+="</tbody></table></div > "}if(document.getElementById("wf-tasks").innerHTML=u,n.IsExecutionGraphEmpty===!0){document.getElementById("wf-add-task").style.display="block";for(var E=document.getElementsByClassName("wf-remove-task"),b=0;b<E.length;b++){var h=E[b];h.style.display="block"}}for(var k=document.getElementsByClassName("wf-add-attribute-td"),I=0;I<k.length;I++){var B=k[I],N=B.parentElement.getElementsByClassName("wf-setting-name")[0].value;"selectFiles"!==N&&"selectetAttachments"!==N||(B.style.display="block")}for(var C=document.getElementsByClassName("wf-add-setting"),x=0;x<C.length;x++){var S=C[x];S.onclick=function(){s(e,this)}}for(var L=document.getElementsByClassName("wf-remove-setting"),P=0;P<L.length;P++){var H=L[P];H.onclick=function(){o(e,this)}}for(var M=document.getElementsByClassName("wf-add-attribute"),A=0;A<M.length;A++){var D=M[A];D.onclick=function(){i(e,this)}}for(var V=document.getElementsByClassName("wf-remove-attribute"),R=0;R<V.length;R++){var W=V[R];W.onclick=function(){r(e,this)}}for(var F=document.getElementsByClassName("wf-remove-task"),O=0;O<F.length;O++){var j=F[O];j.onclick=function(){l(e,this)}}var q=document.getElementById("wf-add-task");q.onclick=function(){a(e,t)};for(var G=function(t){var n=document.getElementsByClassName("wf-task-id")[t];n.onkeyup=function(){T[e][t].Id=n.value,this.parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("wf-task-title-label")[0].innerHTML="Task "+n.value}},J=function(t){var n=document.getElementsByClassName("wf-task-name")[t];n.onchange=function(){T[e][t].Name=n.value}},X=function(t){var n=document.getElementsByClassName("wf-task-desc")[t];n.onkeyup=function(){T[e][t].Description=n.value}},U=function(t){var n=document.getElementsByClassName("wf-task-enabled")[t];n.onchange=function(){T[e][t].IsEnabled=n.checked}},$=function(t,n){var a=document.getElementsByClassName("wf-settings")[t].getElementsByClassName("wf-setting-name")[n];a.onkeyup=function(){T[e][t].Settings[n].Name=a.value;var l=a.parentElement.parentElement.getElementsByClassName("wf-add-attribute-td")[0];"selectFiles"===a.value||"selectAttachments"===a.value?l.style.display="block":l.style.display="none"}},z=function(t,n){var a=document.getElementsByClassName("wf-settings")[t].getElementsByClassName("wf-setting-value")[n];"undefined"!=typeof a&&null!=a&&(a.onkeyup=function(){T[e][t].Settings[n].Value=a.value})},K=function(t,n,a){var l=document.getElementsByClassName("wf-settings")[t].getElementsByClassName("wf-setting-value-td")[n].getElementsByClassName("wf-attribute-name")[a];"undefined"!=typeof l&&null!=l&&(l.onkeyup=function(){T[e][t].Settings[n].Attributes[a].Name=l.value})},Q=function(t,n,a){var l=document.getElementsByClassName("wf-settings")[t].getElementsByClassName("wf-setting-value-td")[n].getElementsByClassName("wf-attribute-value")[a];"undefined"!=typeof l&&null!=l&&(l.onkeyup=function(){T[e][t].Settings[n].Attributes[a].Value=l.value})},Y=0;Y<d.length;Y++){var Z=d[Y];G(Y),J(Y),X(Y),U(Y);for(var _=0;_<Z.Settings.length;_++){var ee=Z.Settings[_];$(Y,_),z(Y,_);for(var te=0;te<ee.Attributes.length;te++)K(Y,_,te),Q(Y,_,te)}}},function(){alert("An error occured while retrieving task names.")})})})}function c(e){var t=N[e.Id].IsRunning!==e.IsRunning||N[e.Id].IsPaused!==e.IsPaused;return N[e.Id].IsRunning=e.IsRunning,N[e.Id].IsPaused=e.IsPaused,t}function f(e,t){b(e,function(e){if(e.IsEnabled===!1)E("This workflow is disabled.");else{if(t===!1&&c(e)===!1)return;E(e.IsRunning===!0&&e.IsPaused===!1?"This workflow is running...":e.IsPaused===!0?"This workflow is suspended.":"This workflow is not running.")}})}function E(e){document.getElementById("wf-status").innerHTML=e}d.sort(w);var I,L=[];for(I=0;I<d.length;I++){var P=d[I];N[P.Id]=P,L.push("<tr><td class='wf-id' title='"+P.Id+"'>"+P.Id+"</td><td class='wf-n' title='"+P.Name+"'>"+P.Name+"</td></tr>")}var H="<table id='wf-workflows-table' class='table table-striped'><thead><tr><th class='wf-id'>Id</th><th class='wf-n'>Name</th></tr></thead><tbody>"+L.join("")+"</tbody></table>";document.getElementById("wf-workflows").innerHTML=H,document.getElementById("wf-action").style.display="block";var M=document.getElementById("wf-workflows-table"),A=M.getElementsByTagName("tbody")[0].getElementsByTagName("tr");for(I=0;I<A.length;I++)A[I].onclick=function(){B=parseInt(this.getElementsByClassName("wf-id")[0].innerHTML);var e=document.getElementsByClassName("selected");e.length>0&&(e[0].className=e[0].className.replace("selected","")),this.className+="selected",u(B),document.getElementById("wf-cancel").onclick=function(){u(B)},document.getElementById("wf-save").onclick=function(){n(B)}};"undefined"!=typeof e&&e()},function(){alert("An error occured while retrieving workflows. Check Wexflow Web Service Uri and check that Wexflow Windows Service is running correctly.")})}hljs.initHighlightingOnLoad(),t=f(t,"/");var B=-1,N={},C={},T={},x=null,S=500,L=!1,P="<h3>Workflow <button id='wf-xml' type='button' class='wf-action-left'>xml</button></h3><pre><code id='wf-xml-container' class='xml'></code></pre><table class='wf-designer-table'><tbody><tr><td class='wf-title'>Id</td><td class='wf-value'><input id='wf-id' type='text'  /></td></tr><tr><td class='wf-title'>Name</td><td class='wf-value'><input id='wf-name' type='text' /></td></tr><tr><td class='wf-title'>LaunchType</td><td class='wf-value'><select id='wf-launchType'><option value=''></option><option value='startup'>Startup</option><option value='trigger'>Trigger</option><option value='periodic'>Periodic</option></select></td></tr><tr><td class='wf-title'>Period</td><td class='wf-value'><input id='wf-period' type='text' /></td></tr><tr><td class='wf-title'>Enabled</td><td class='wf-value'><input id='wf-enabled' type='checkbox' checked/></td></tr><tr><td class='wf-title'>Description</td><td class='wf-value'><input id='wf-desc' type='text' /></td></tr><tr><td class='wf-title'>Path</td><td id='wf-path' class='wf-value'></td></tr><tr><td class='wf-title'>Status</td><td id='wf-status' class='wf-value'></td></tr></tbody></table><h3>Tasks</h3><div id='wf-tasks'></div><button type='button' id='wf-add-task'>new task</button>",H="<div id='wf-container'><div id='wf-workflows'></div><div id='wf-action'><button type='button' id='wf-add-workflow'>new workflow</button><button id='wf-save' type= 'button' class='wf-action-right'>save</button><button id='wf-cancel' type= 'button' class='wf-action-right'>cancel</button></div><div id='wf-designer-right-panel' style='display: none;'>"+P+"</div></div>";document.getElementById(e).innerHTML=H,document.getElementById("wf-add-workflow").onclick=function(){L=!1;var e=document.getElementById("wf-designer-right-panel");e.innerHTML=P,e.style.display="block",document.getElementById("wf-cancel").style.display="block",document.getElementById("wf-save").style.display="block",document.getElementById("wf-add-task").style.display="block",document.getElementById("wf-xml").style.display="none",document.getElementById("wf-cancel").onclick=function(){},document.getElementById("wf-id").onkeyup=function(){var e=parseInt(this.value);C[e]={Id:e,Name:document.getElementById("wf-name").value,LaunchType:v(document.getElementById("wf-launchType").value),Period:document.getElementById("wf-period").value,IsEnabled:document.getElementById("wf-enabled").checked,Description:document.getElementById("wf-desc").value,Path:"",IsNew:!0},T[e]=[]},document.getElementById("wf-name").onkeyup=function(){var e=this,n=document.getElementById("wf-id").value;if(c(n)){var a=parseInt(n);C[a].Name=this.value,""!==this.value&&y(t+"/workflowsFolder",function(t){C[a].Path=f(t,"\\")+"\\"+e.value+".xml",document.getElementById("wf-path").innerHTML=C[a].Path},function(){alert("An error occured while retrieving workflowsFolder.")})}},document.getElementById("wf-launchType").onchange=function(){var e=document.getElementById("wf-id").value;if(c(e)){var t=parseInt(e);C[t].LaunchType=v(this.value)}},document.getElementById("wf-period").onkeyup=function(){var e=document.getElementById("wf-id").value;if(c(e)){var t=parseInt(e);C[t].Period=this.value}},document.getElementById("wf-enabled").onchange=function(){var e=document.getElementById("wf-id").value;if(c(e)){var t=parseInt(e);C[t].IsEnabled=this.checked}},document.getElementById("wf-desc").onkeyup=function(){var e=document.getElementById("wf-id").value;if(c(e)){var t=parseInt(e);C[t].Description=this.value}},document.getElementById("wf-save").onclick=function(){var e=document.getElementById("wf-id").value;if(c(e)){var a=parseInt(e);y(t+"/isWorkflowIdValid/"+a,function(e){if(e===!0||L===!0)if(""===document.getElementById("wf-name").value)alert("Please enter the name of the workflow.");else{var t=document.getElementById("wf-launchType").value;""===t?alert("Please select the launchType of the workflow."):"periodic"===t&&""===document.getElementById("wf-period").value?alert("Please enter the period of the workflow."):n(a,function(){L=!0,setTimeout(function(){I(function(){for(var e=document.getElementById("wf-workflows-table"),t=0;t<e.rows.length;t++){var n=e.rows[t],l=n.getElementsByClassName("wf-id")[0];if("undefined"!=typeof l&&null!=l){var s=parseInt(l.innerHTML);if(s===a){var i=document.getElementsByClassName("selected");i.length>0&&(i[0].className=i[0].className.replace("selected","")),n.className+="selected",n.scrollIntoView(!0)}}}})},500)})}else alert("The workflow Id is already in use. Please enter an other one.")})}else alert("Please enter a valid workflow id.")},y(t+"/taskNames",function(e){document.getElementById("wf-add-task").onclick=function(){var t=document.getElementById("wf-id").value;if(c(t)){var n=parseInt(t);a(n,e)}else alert("Please enter a valid workflow id.")}},function(){alert("An error occured while retrieving task names.")})},I()}
function WexflowDesigner(t,e){"use strict";function n(t,e){for(;t.charAt(t.length-1)===e;)t=t.substring(0,t.length-1);return t}function a(t){return t.replace(/[<>&'"]/g,function(t){switch(t){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}return t})}function s(t,e){return t.Id<e.Id?-1:t.Id>e.Id?1:0}function l(t){switch(t){case 0:return"startup";case 1:return"trigger";case 2:return"periodic";default:return""}}function i(t){switch(t){case"startup":return 0;case"trigger":return 1;case"periodic":return 2;default:return-1}}function d(t,e){for(var n=0;n<t.options.length;n++)if(t.options[n].value===e)return void(t.options[n].selected=!0)}function r(t,e,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&e){var t=JSON.parse(this.responseText);e(t)}},a.onerror=function(){n&&n()},a.open("GET",t,!0),a.send()}function u(t,e,n,a){var s=new XMLHttpRequest;s.onreadystatechange=function(){4===this.readyState&&200===this.status&&e&&e(this.responseText)},s.onerror=function(){n&&n()},s.open("POST",t,!0),s.send(JSON.stringify(a))}hljs.initHighlightingOnLoad(),e=n(e,"/");var o=-1,c={},f={},w={},g=null,m=500,v="<div id='wf-container'><div id='wf-workflows'></div><div id='wf-designer-right-panel' style='display: none;'><h3>Workflow <button id= 'wf-xml-button' type= 'button' class='action-left'>xml</button> <button id= 'wf-save-button' type= 'button' class='action-right'>save</button><button id= 'wf-cancel-button' type= 'button' class='action-right'>cancel</button></h3><pre><code id='wf-xml-container' class='xml'></pre><table class='wf-designer-table'><tbody>        <tr><td class='wf-title'>Id</td><td class='wf-value'><input id='wf-id' type='text'  /></td></tr>        <tr><td class='wf-title'>Name</td><td class='wf-value'><input id='wf-name' type='text' /></td></tr>        <tr><td class='wf-title'>LaunchType</td><td class='wf-value'><select id='wf-launchType' ><option value='startup'>Startup</option><option value='trigger'>Trigger</option><option value='periodic'>Periodic</option></select></td></tr>        <tr><td class='wf-title'>Period</td><td class='wf-value'><input id='wf-period' type='text' /></td></tr>        <tr><td class='wf-title'>Enabled</td><td class='wf-value'><input id='wf-enabled' type='checkbox'   /></td></tr>        <tr><td class='wf-title'>Description</td><td class='wf-value'><input id='wf-desc' type='text' /></td></tr>        <tr><td class='wf-title'>Path</td><td id='wf-path' class='wf-value'></td></tr>        <tr><td class='wf-title'>Status</td><td id='wf-status' class='wf-value'></td></tr></tbody></table>        <h3>Tasks</h3>        <div id='wf-tasks'>        </div>    </div></div>";document.getElementById(t).innerHTML=v,r(e+"/workflows",function(t){function n(t,n){r(e+"/workflow/"+t,function(t){n(t)})}function v(t,n){r(e+"/tasks/"+t,function(t){n(t)})}function p(t,n){r(e+"/xml/"+t,function(t){n(t)})}function y(t){"none"===document.getElementById("wf-designer-right-panel").style.display&&(document.getElementById("wf-designer-right-panel").style.display="block");var e=document.getElementById("wf-xml-container");e.innerHTML="",document.getElementById("wf-xml-button").onclick=function(){p(t,function(t){e.innerHTML=a(t),hljs.highlightBlock(e)})},n(t,function(e){f[e.Id]={Id:e.Id,Name:e.Name,LaunchType:e.LaunchType,Period:e.Period,IsEnabled:e.IsEnabled,Description:e.Description,Path:e.Path};var n=document.getElementById("wf-id");n.value=e.Id,n.onkeyup=function(){f[t].Id=n.value};var a=document.getElementById("wf-name");a.value=e.Name,a.onkeyup=function(){f[t].Name=a.value};var s=l(e.LaunchType),r=document.getElementById("wf-launchType");d(r,s),r.onchange=function(){f[t].LaunchType=i(r.value)};var u=document.getElementById("wf-period");u.value=e.Period,u.onkeyup=function(){f[t].Period=u.value};var o=document.getElementById("wf-enabled");o.checked=e.IsEnabled,o.onchange=function(){f[t].IsEnabled=o.checked};var c=document.getElementById("wf-desc");c.value=e.Description,c.onkeyup=function(){f[t].Period=c.value},document.getElementById("wf-path").innerHTML=e.Path,clearInterval(g),e.IsEnabled===!0?(g=setInterval(function(){b(t,!1)},m),b(t,!0)):b(t,!0),v(t,function(e){w[t]=e;for(var n="",a=0;a<e.length;a++){var s=e[a];n+="<div id='wf-task'><h5 class='wf-task-title'>Task "+s.Id+"</h5><table class='wf-designer-table'><tbody>        <tr><td class='wf-title'>Id</td><td class='wf-value'><input class='wf-task-id' type='text' value='"+s.Id+"' readonly /></td></tr>        <tr><td class='wf-title'>Name</td><td class='wf-value'><input class='wf-task-name' type='text' value='"+s.Name+"' readonly /></td></tr>        <tr><td class='wf-title'>Description</td><td class='wf-value'><input class='wf-task-desc' type='text' value='"+s.Description+"' /></td></tr>        <tr><td class='wf-title'>Enabled</td><td class='wf-value'><input class='wf-task-enabled' type='checkbox'   "+(s.IsEnabled?"checked":"")+" /></td></tr></tbody></table><h6>Settings</h6><table class='wf-designer-table wf-settings'><tbody>";for(var l=0;l<s.Settings.length;l++){var i=s.Settings[l];if(n+="<tr><td class='wf-title'><input class='wf-setting-name' type='text' value='"+i.Name+"'  /></td><td class='wf-setting-value-td'>",""!==i.Value&&(n+="<input class='wf-setting-value' type='text' value='"+i.Value+"'  />"),i.Attributes.length>0){n+="<table>";for(var d=0;d<i.Attributes.length;d++){var r=i.Attributes[d];n+="<tr><td><input class='wf-attribute-name' type='text' value='"+r.Name+"'  /><td><input class='wf-attribute-value' type='text' value='"+r.Value+"'  /></tr>"}n+="</table>"}n+="</td></tr>"}n+="</tbody></table></div > "}document.getElementById("wf-tasks").innerHTML=n;for(var u=function(e){var n=document.getElementsByClassName("wf-task-id")[e];n.onkeyup=function(){w[t][e].Id=n.value}},o=function(e){var n=document.getElementsByClassName("wf-task-name")[e];n.onkeyup=function(){w[t][e].Name=n.value}},c=function(e){var n=document.getElementsByClassName("wf-task-desc")[e];n.onkeyup=function(){w[t][e].Description=n.value}},f=function(e){var n=document.getElementsByClassName("wf-task-enabled")[e];n.onchange=function(){w[t][e].IsEnabled=n.checked}},g=function(e,n){var a=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-name")[n];a.onkeyup=function(){w[t][e].Settings[n].Name=a.value}},m=function(e,n){var a=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-value")[n];"undefined"!=typeof a&&null!=a&&(a.onkeyup=function(){w[t][e].Settings[n].Value=a.value})},v=function(e,n,a){var s=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-value-td")[n].getElementsByClassName("wf-attribute-name")[a];"undefined"!=typeof s&&null!=s&&(s.onkeyup=function(){w[t][e].Settings[n].Attributes[a].Name=s.value})},p=function(e,n,a){var s=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-value-td")[n].getElementsByClassName("wf-attribute-value")[a];"undefined"!=typeof s&&null!=s&&(s.onkeyup=function(){w[t][e].Settings[n].Attributes[a].Value=s.value})},y=0;y<e.length;y++){var h=e[y];u(y),o(y),c(y),f(y);for(var b=0;b<h.Settings.length;b++){var I=h.Settings[b];g(y,b),m(y,b);for(var k=0;k<I.Attributes.length;k++)v(y,b,k),p(y,b,k)}}})})}function h(t){var e=c[t.Id].IsRunning!==t.IsRunning||c[t.Id].IsPaused!==t.IsPaused;return c[t.Id].IsRunning=t.IsRunning,c[t.Id].IsPaused=t.IsPaused,e}function b(t,e){n(t,function(t){if(t.IsEnabled===!1)I("This workflow is .");else{if(e===!1&&h(t)===!1)return;I(t.IsRunning===!0&&t.IsPaused===!1?"This workflow is running...":t.IsPaused===!0?"This workflow is suspended.":"This workflow is not running.")}})}function I(t){document.getElementById("wf-status").innerHTML=t}t.sort(s);var k,E=[];for(k=0;k<t.length;k++){var N=t[k];c[N.Id]=N,E.push("<tr><td class='wf-id' title='"+N.Id+"'>"+N.Id+"</td><td class='wf-n' title='"+N.Name+"'>"+N.Name+"</td></tr>")}var B="<table id='wf-workflows-table' class='table table-striped'><thead><tr><th class='wf-id'>Id</th><th class='wf-n'>Name</th></tr></thead><tbody>"+E.join("")+"</tbody></table>";document.getElementById("wf-workflows").innerHTML=B;var T=document.getElementById("wf-workflows-table"),x=T.getElementsByTagName("tbody")[0].getElementsByTagName("tr");for(k=0;k<x.length;k++)x[k].onclick=function(){o=parseInt(this.getElementsByClassName("wf-id")[0].innerHTML);var t=document.getElementsByClassName("selected");t.length>0&&(t[0].className=t[0].className.replace("selected","")),this.className+="selected",y(o),document.getElementById("wf-cancel-button").onclick=function(){y(o)},document.getElementById("wf-save-button").onclick=function(){var t={Id:o,WorkflowInfo:f[o],Tasks:w[o]};u(e+"/save",function(t){var e="true"==t;e===!0?alert("workflow "+f[o].Id+" saved and reloaded with success."):alert("An error occured while saving the workflow "+o+".")},function(){alert("An error occured while saving the workflow "+o+".")},t)}}},function(){alert("An error occured while retrieving workflows. Check Wexflow Web Service Uri and check that Wexflow Windows Service is running correctly.")})}
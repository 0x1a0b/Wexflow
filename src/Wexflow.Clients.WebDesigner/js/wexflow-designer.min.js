function WexflowDesigner(t,e){"use strict";function n(t,e){for(;t.charAt(t.length-1)===e;)t=t.substring(0,t.length-1);return t}function a(t){return t.replace(/[<>&'"]/g,function(t){switch(t){case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case"'":return"&apos;";case'"':return"&quot;"}return t})}function s(t,e){return t.Id<e.Id?-1:t.Id>e.Id?1:0}function l(t){switch(t){case 0:return"startup";case 1:return"trigger";case 2:return"periodic";default:return""}}function i(t){switch(t){case"startup":return 0;case"trigger":return 1;case"periodic":return 2;default:return-1}}function r(t,e){for(var n=0;n<t.options.length;n++)if(t.options[n].value===e)return void(t.options[n].selected=!0)}function o(t,e,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status&&e){var t=JSON.parse(this.responseText);e(t)}},a.onerror=function(){n&&n()},a.open("GET",t,!0),a.send()}function u(t,e,n,a){var s=new XMLHttpRequest;s.onreadystatechange=function(){4===this.readyState&&200===this.status&&e&&e(this.responseText)},s.onerror=function(){n&&n()},s.open("POST",t,!0),s.send(JSON.stringify(a))}hljs.initHighlightingOnLoad(),e=n(e,"/");var c=-1,d={},f={},m={},p=null,w=500,v="<div id='wf-container'><div id='wf-workflows'></div><div id='wf-designer-right-panel' style='display: none;'><h3>Workflow <button id= 'wf-xml-button' type='button' class='wf-action-left'>xml</button> <button id= 'wf-save-button' type= 'button' class='wf-action-right'>save</button><button id= 'wf-cancel-button' type= 'button' class='wf-action-right'>cancel</button></h3><pre><code id='wf-xml-container' class='xml'></pre><table class='wf-designer-table'><tbody>        <tr><td class='wf-title'>Id</td><td class='wf-value'><input id='wf-id' type='text'  /></td></tr>        <tr><td class='wf-title'>Name</td><td class='wf-value'><input id='wf-name' type='text' /></td></tr>        <tr><td class='wf-title'>LaunchType</td><td class='wf-value'><select id='wf-launchType' ><option value='startup'>Startup</option><option value='trigger'>Trigger</option><option value='periodic'>Periodic</option></select></td></tr>        <tr><td class='wf-title'>Period</td><td class='wf-value'><input id='wf-period' type='text' /></td></tr>        <tr><td class='wf-title'>Enabled</td><td class='wf-value'><input id='wf-enabled' type='checkbox'   /></td></tr>        <tr><td class='wf-title'>Description</td><td class='wf-value'><input id='wf-desc' type='text' /></td></tr>        <tr><td class='wf-title'>Path</td><td id='wf-path' class='wf-value'></td></tr>        <tr><td class='wf-title'>Status</td><td id='wf-status' class='wf-value'></td></tr></tbody></table>        <h3>Tasks</h3>        <div id='wf-tasks'>        </div>    </div></div>";document.getElementById(t).innerHTML=v,o(e+"/workflows",function(t){function n(t,n){o(e+"/workflow/"+t,function(t){n(t)})}function v(t,n){o(e+"/tasks/"+t,function(t){n(t)})}function g(t,n){o(e+"/xml/"+t,function(t){n(t)})}function y(t){"none"===document.getElementById("wf-designer-right-panel").style.display&&(document.getElementById("wf-designer-right-panel").style.display="block");var s=document.getElementById("wf-xml-container");s.innerHTML="",document.getElementById("wf-xml-button").onclick=function(){g(t,function(t){s.innerHTML=a(t),hljs.highlightBlock(s)})},n(t,function(n){f[n.Id]={Id:n.Id,Name:n.Name,LaunchType:n.LaunchType,Period:n.Period,IsEnabled:n.IsEnabled,Description:n.Description,Path:n.Path};var a=document.getElementById("wf-id");a.value=n.Id,a.onkeyup=function(){f[t].Id=a.value};var s=document.getElementById("wf-name");s.value=n.Name,s.onkeyup=function(){f[t].Name=s.value};var u=l(n.LaunchType),c=document.getElementById("wf-launchType");r(c,u),c.onchange=function(){f[t].LaunchType=i(c.value)};var d=document.getElementById("wf-period");d.value=n.Period,d.onkeyup=function(){f[t].Period=d.value};var g=document.getElementById("wf-enabled");g.checked=n.IsEnabled,g.onchange=function(){f[t].IsEnabled=g.checked};var y=document.getElementById("wf-desc");y.value=n.Description,y.onkeyup=function(){f[t].Period=y.value},document.getElementById("wf-path").innerHTML=n.Path,clearInterval(p),n.IsEnabled===!0?(p=setInterval(function(){k(t,!1)},w),k(t,!0)):k(t,!0),v(t,function(a){m[t]=a;var s="";o(e+"/taskNames",function(e){for(var l=0;l<a.length;l++){var i=a[l];s+="<div class='wf-task'><h5 class='wf-task-title'><label class='wf-task-title-label'>Task "+i.Id+"</label><button type='button' class='wf-remove-task'>remove</button></h5><table class='wf-designer-table'><tbody>        <tr><td class='wf-title'>Id</td><td class='wf-value'><input class='wf-task-id' type='text' value='"+i.Id+"'"+(n.IsExecutionGraphEmpty===!1?"readonly":"")+"/></td></tr>        <tr><td class='wf-title'>Name</td><td class='wf-value'><select class='wf-task-name'>";for(var r=0;r<e.length;r++){var o=e[r];s+="<option value='"+o+"' "+(o===i.Name?"selected":"")+">"+o+"</option>"}s+="</select></td></tr>        <tr><td class='wf-title'>Description</td><td class='wf-value'><input class='wf-task-desc' type='text' value='"+i.Description+"' /></td></tr>        <tr><td class='wf-title'>Enabled</td><td class='wf-value'><input class='wf-task-enabled' type='checkbox'   "+(i.IsEnabled?"checked":"")+" /></td></tr></tbody></table><h6>Settings<button type='button' class='wf-add-setting'>setting</button></h6><table class='wf-designer-table wf-settings'><tbody>";for(var u=0;u<i.Settings.length;u++){var c=i.Settings[u];s+="<tr><td class='wf-title'><input class='wf-setting-name' type='text' value='"+c.Name+"'  /></td><td class='wf-setting-value-td'>",s+="<input class='wf-setting-value' type='text' value='"+c.Value+"'  />",s+="<table class='wf-attributes'>";for(var d=0;d<c.Attributes.length;d++){var f=c.Attributes[d];s+="<tr><td><input class='wf-attribute-name' type='text' value='"+f.Name+"'  /></td><td><input class='wf-attribute-value' type='text' value='"+f.Value+"'  /></td><td><button type='button' class='wf-remove-attribute'>remove</button></td></tr>"}s+="</table>",s+="</td><td class='wf-add-attribute-td'><button type='button' class='wf-add-attribute'>attribute</button></td><td><button type='button' class='wf-remove-setting'>remove</button></td></tr>"}s+="</tbody></table></div > "}s+="<button type='button' id='wf-add-task'>task</button>",document.getElementById("wf-tasks").innerHTML=s,n.IsExecutionGraphEmpty===!0&&(document.getElementById("wf-add-task").style.display="block");for(var p=document.getElementsByClassName("wf-add-attribute-td"),w=0;w<p.length;w++){var v=p[w],g=v.parentElement.getElementsByClassName("wf-setting-name")[0].value;"selectFiles"!==g&&"selectetAttachments"!==g||(v.style.display="block")}for(var y=function(e){var n=b(e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),a=m[t][n],s=b(e.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),l=b(e.parentElement.parentElement);a.Settings[s].Attributes=E(a.Settings[s].Attributes,l),e.parentElement.parentElement.remove()},h=function(){var e=this.parentElement.parentElement.getElementsByClassName("wf-attributes")[0],n=e.insertRow(-1),a=n.insertCell(0),s=n.insertCell(1),l=n.insertCell(2);a.innerHTML="<input class='wf-attribute-name' type='text' />",s.innerHTML="<input class='wf-attribute-value' type='text' />",l.innerHTML="<button type='button' class='wf-remove-attribute'>remove</button>";var i=b(this.parentElement.parentElement.parentElement.parentElement.parentElement),r=m[t][i],o=b(this.parentElement.parentElement);r.Settings[o].Attributes.push({Name:"",Value:""});var u=r.Settings[o].Attributes.length-1,c=e.getElementsByClassName("wf-attribute-name")[u];c.onkeyup=function(){r.Settings[o].Attributes[u].Name=c.value};var d=e.getElementsByClassName("wf-attribute-value")[u];d.onkeyup=function(){r.Settings[o].Attributes[u].Value=d.value};var f=e.getElementsByClassName("wf-remove-attribute")[u];f.onclick=function(){y(this),u--}},k=function(e){var n=b(e.parentElement.parentElement.parentElement.parentElement.parentElement),a=m[t][n],s=b(e.parentElement.parentElement);a.Settings=E(a.Settings,s),e.parentElement.parentElement.remove()},N=function(){var e=this.parentElement.parentElement.getElementsByClassName("wf-settings")[0],n=e.insertRow(-1),a=n.insertCell(0),s=n.insertCell(1),l=n.insertCell(2),i=n.insertCell(3);a.className="wf-title",a.innerHTML="<input class='wf-setting-name' type='text' />",s.className="wf-setting-value-td",s.innerHTML="<input class='wf-setting-value' type='text' /><table class='wf-attributes'></table>",l.className="wf-add-attribute-td",l.innerHTML="<button type='button' class='wf-add-attribute'>attribute</button>",i.innerHTML="<button type='button' class='wf-remove-setting'>remove</button>";var r=b(this.parentElement.parentElement),o=m[t][r];o.Settings.push({Name:"",Value:"",Attributes:[]});var u=o.Settings.length-1,c=e.getElementsByClassName("wf-setting-name")[u];c.onkeyup=function(){o.Settings[u].Name=c.value;var t=c.parentElement.parentElement.getElementsByClassName("wf-add-attribute-td")[0];"selectFiles"===c.value||"selectAttachments"===c.value?t.style.display="block":t.style.display="none"};var d=e.getElementsByClassName("wf-setting-value")[u];"undefined"!=typeof d&&null!=d&&(d.onkeyup=function(){o.Settings[u].Value=d.value});var f=e.getElementsByClassName("wf-add-attribute")[u];f.onclick=h;var p=e.getElementsByClassName("wf-remove-setting")[u];p.onclick=function(){k(this),u--}},I=document.getElementsByClassName("wf-add-setting"),B=0;B<I.length;B++){var C=I[B];C.onclick=N}for(var T=document.getElementsByClassName("wf-remove-setting"),x=0;x<T.length;x++){var S=T[x];S.onclick=function(){k(this)}}for(var L=document.getElementsByClassName("wf-add-attribute"),H=0;H<L.length;H++){var A=L[H];A.onclick=h}for(var M=document.getElementsByClassName("wf-remove-attribute"),P=0;P<M.length;P++){var D=M[P];D.onclick=function(){y(this)}}for(var R=function(){var e=b(this.parentElement.parentElement);m[t]=E(m[t],e),this.parentElement.parentElement.remove()},V=document.getElementsByClassName("wf-remove-task"),W=0;W<V.length;W++){var O=V[W];O.onclick=R}var j=document.getElementById("wf-add-task");j.onclick=function(){var n=document.createElement("div");n.className="wf-task";var a="<h5 class='wf-task-title'><label class='wf-task-title-label'>Task</label><button type='button' class='wf-remove-task'>remove</button></h5><table class='wf-designer-table'><tbody>        <tr><td class='wf-title'>Id</td><td class='wf-value'><input class='wf-task-id' type='text' /></td></tr>        <tr><td class='wf-title'>Name</td><td class='wf-value'><select class='wf-task-name'>";a+="<option value=''></option>";for(var s=0;s<e.length;s++){var l=e[s];a+="<option value='"+l+"'>"+l+"</option>"}a+="</select></td></tr>        <tr><td class='wf-title'>Description</td><td class='wf-value'><input class='wf-task-desc' type='text' /></td></tr>        <tr><td class='wf-title'>Enabled</td><td class='wf-value'><input class='wf-task-enabled' type='checkbox' checked /></td></tr></tbody></table><h6>Settings<button type='button' class='wf-add-setting'>setting</button></h6><table class='wf-designer-table wf-settings'></table>",n.innerHTML=a;var i=document.getElementsByClassName("wf-task")[m[t].length-1];i.parentNode.insertBefore(n,i.nextSibling),m[t].push({Id:0,Name:"",Description:"",IsEnabled:!0,Settings:[]});var r=b(n),o=n.getElementsByClassName("wf-task-id")[0];o.onkeyup=function(){m[t][r].Id=o.value,this.parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("wf-task-title-label")[0].innerHTML="Task "+o.value};var u=n.getElementsByClassName("wf-task-name")[0];u.onchange=function(){console.log(u.value),m[t][r].Name=u.value};var c=n.getElementsByClassName("wf-task-desc")[0];c.onkeyup=function(){m[t][r].Description=c.value};var d=n.getElementsByClassName("wf-task-enabled")[0];d.onchange=function(){m[t][r].IsEnabled=d.checked};var f=n.getElementsByClassName("wf-add-setting")[0];f.onclick=N;var p=n.getElementsByClassName("wf-remove-task")[0];p.onclick=R};for(var q=function(e){var n=document.getElementsByClassName("wf-task-id")[e];n.onkeyup=function(){m[t][e].Id=n.value,this.parentElement.parentElement.parentElement.parentElement.parentElement.getElementsByClassName("wf-task-title-label")[0].innerHTML="Task "+n.value}},F=function(e){var n=document.getElementsByClassName("wf-task-name")[e];n.onchange=function(){m[t][e].Name=n.value}},G=function(e){var n=document.getElementsByClassName("wf-task-desc")[e];n.onkeyup=function(){m[t][e].Description=n.value}},J=function(e){var n=document.getElementsByClassName("wf-task-enabled")[e];n.onchange=function(){m[t][e].IsEnabled=n.checked}},X=function(e,n){var a=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-name")[n];a.onkeyup=function(){m[t][e].Settings[n].Name=a.value;var s=a.parentElement.parentElement.getElementsByClassName("wf-add-attribute-td")[0];"selectFiles"===a.value||"selectAttachments"===a.value?s.style.display="block":s.style.display="none"}},U=function(e,n){var a=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-value")[n];"undefined"!=typeof a&&null!=a&&(a.onkeyup=function(){m[t][e].Settings[n].Value=a.value})},z=function(e,n,a){var s=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-value-td")[n].getElementsByClassName("wf-attribute-name")[a];"undefined"!=typeof s&&null!=s&&(s.onkeyup=function(){m[t][e].Settings[n].Attributes[a].Name=s.value})},K=function(e,n,a){var s=document.getElementsByClassName("wf-settings")[e].getElementsByClassName("wf-setting-value-td")[n].getElementsByClassName("wf-attribute-value")[a];"undefined"!=typeof s&&null!=s&&(s.onkeyup=function(){m[t][e].Settings[n].Attributes[a].Value=s.value})},Q=0;Q<a.length;Q++){var Y=a[Q];q(Q),F(Q),G(Q),J(Q);for(var Z=0;Z<Y.Settings.length;Z++){var $=Y.Settings[Z];X(Q,Z),U(Q,Z);for(var _=0;_<$.Attributes.length;_++)z(Q,Z,_),K(Q,Z,_)}}},function(){alert("An error occured while retrieving task names.")})})})}function b(t){for(var e=0;t=t.previousElementSibling;)e++;return e}function E(t,e){return t=t.slice(0),t.splice(e,1),t}function h(t){var e=d[t.Id].IsRunning!==t.IsRunning||d[t.Id].IsPaused!==t.IsPaused;return d[t.Id].IsRunning=t.IsRunning,d[t.Id].IsPaused=t.IsPaused,e}function k(t,e){n(t,function(t){if(t.IsEnabled===!1)N("This workflow is .");else{if(e===!1&&h(t)===!1)return;N(t.IsRunning===!0&&t.IsPaused===!1?"This workflow is running...":t.IsPaused===!0?"This workflow is suspended.":"This workflow is not running.")}})}function N(t){document.getElementById("wf-status").innerHTML=t}t.sort(s);var I,B=[];for(I=0;I<t.length;I++){var C=t[I];d[C.Id]=C,B.push("<tr><td class='wf-id' title='"+C.Id+"'>"+C.Id+"</td><td class='wf-n' title='"+C.Name+"'>"+C.Name+"</td></tr>")}var T="<table id='wf-workflows-table' class='table table-striped'><thead><tr><th class='wf-id'>Id</th><th class='wf-n'>Name</th></tr></thead><tbody>"+B.join("")+"</tbody></table>";document.getElementById("wf-workflows").innerHTML=T;var x=document.getElementById("wf-workflows-table"),S=x.getElementsByTagName("tbody")[0].getElementsByTagName("tr");for(I=0;I<S.length;I++)S[I].onclick=function(){c=parseInt(this.getElementsByClassName("wf-id")[0].innerHTML);var t=document.getElementsByClassName("selected");t.length>0&&(t[0].className=t[0].className.replace("selected","")),this.className+="selected",y(c),document.getElementById("wf-cancel-button").onclick=function(){y(c)},document.getElementById("wf-save-button").onclick=function(){var t={Id:c,WorkflowInfo:f[c],Tasks:m[c]};u(e+"/save",function(t){var e="true"===t;e===!0?alert("workflow "+f[c].Id+" saved and reloaded with success."):alert("An error occured while saving the workflow "+c+".")},function(){alert("An error occured while saving the workflow "+c+".")},t)}}},function(){alert("An error occured while retrieving workflows. Check Wexflow Web Service Uri and check that Wexflow Windows Service is running correctly.")})}
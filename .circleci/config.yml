version: 2.1

orbs:
  win: circleci/windows@1.0.0
  
jobs:
  build:
    working_directory: ~/code
    docker:
      - image: circleci/android:api-26
    environment:
      JVM_OPTS: -Xmx4G
    steps:
      - checkout
      - run:
          name: "Install project Dependencies"
          working_directory: ~/code/src/android
          command: ./gradlew androidDependencies
      - run:
          name: "Build"
          working_directory: ~/code/src/android
          command: ./gradlew clean build --stacktrace
  #build:
  #  working_directory: ~/code
  #  macos:
  #    xcode: "8.3.3"
  #  steps:
  #    - checkout
  #    - run:
  #        name: "Build"
  #        working_directory: ~/code/src/ios
  #        command: xcodebuild clean build -scheme "Wexflow" CODE_SIGN_IDENTITY="" CODE_SIGNING_REQUIRED=NO
  build:
    executor:
      name: win/vs2019
      shell: powershell.exe
    steps:
      - checkout
      - run:
          name: "Install project dependencies"
          working_directory: ~/code/src/dotnet-core/Wexflow.Server
          command: dotnet.exe restore Wexflow.Server.csproj
      - run:
          name: "Build"
          working_directory: ~/code/src/dotnet-core/Wexflow.Server
          command: dotnet.exe publish Wexflow.Server.csproj -c Release -r win10-x64
  